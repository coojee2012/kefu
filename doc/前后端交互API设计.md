# 前后端完全分离之API设计

> API是开发者和使用者交互的桥梁，开发者提供完善友好的API，对于使用者来说，是有很大便利。jQuery风靡全球其中一个原因就是API设计很不错，对使用者非常友好，不用去看文档，就大概知道这个API是做什么的。

现在开发都流行前后端分离，前端渲染视图，后端提供数据，这时候前后端如何交互呢？就需要双方约定协商API规范。

接下来就说说本项目设计的API接口，若有错误欢迎纠正。

## 什么是Restful？
REST是“REpresentational State Transfer”的缩写，可以翻译成“表现状态转换”，但是在绝大多数场合中我们只说REST或者RESTful。为什么会起这么一个奇怪的名字呢？我们可以从上述这篇论文中找到答案。Fielding在论文中将REST定位为“分布式超媒体应用（Distributed Hypermedia System）”的架构风格，它在文中提到一个名为“HATEOAS（Hypermedia as the engine of application state）”的概念。

我们利用一个面向最终用户的Web应用来对这个概念进行简单阐述：这里所谓的应用状态（Application State）表示Web应用的客户端的状态，简单起见可以理解为会话状态。资源在浏览器中以超媒体的形式呈现，通过点击超媒体中的链接可以获取其它相关的资源或者对当前资源进行相应的处理，获取的资源或者针对资源处理的响应同样以超媒体的形式再次呈现在浏览器上。由此可见，超媒体成为了驱动客户端会话状态的转换的引擎。

借助于超媒体这种特殊的资源呈现方式，应用状态的转换体现为浏览器中呈现资源的转换。如果将超媒体进一步抽象成一般意义上的资源呈现（Representation ）方式，那么应用状态变成了可被呈现的状态（REpresentational State）。应用状态之间的转换就成了可被呈现的状态装换（REpresentational State Transfer），这就是REST。

REST在我看来是一种很笼统的概念，它代表一种架构风格。对于多个Web应用采用的架构，我们只能说其中某一个比其它的更具有REST风格，而不能简单粗暴地说：“它采用了REST架构而其它的没有”。为了将REST真正地落地，Lenoard Rechardson & Sam Ruby在《RESTful Web Services》一书中提出了一种名为“面向资源的架构（ROA： Resource Oriented Architecture）”。该书中介绍了一些采用ROA架构的Web服务应该具备的基本特征，它们可以指导我们如果构架具体的RESTful Web API。

## 采用URI标识资源
SOAP Web API采用RPC风格，它采用面向功能的架构，所以我们在设计SOAP Web API的时候首相考虑的是应高提供怎样的功能（或者操作）。RESTful Web API采用面向资源的架构，所以在设计之初首先需要考虑的是有哪些资源可供操作。

资源是一个很宽泛的概念，任何寄宿于Web可供操作的“事物”均可视为资源。资源可以体现为经过持久化处理保存到磁盘上的某个文件或者数据库中某个表的某条记录，也可以是Web应用接受到请求后采用某种算法计算得出的结果。资源可以体现为一个具体的物理对象，它也可以是一个抽象的流程。

一个资源必须具有一个或者多个标识，既然我们设计的Web API，那么很自然地应该采用URI来作为资源的标识。作为资源标识的URI最好具有“可读性”，因为具有可读性的URI更容易被使用，使用者一看就知道被标识的是何种资源。

## API设计理念（基于Restful设计API）
- 将涉及的实体抽象成资源, 即按id访问资源, 在url上做处理
- 使用HTTP动词对资源进行CRUD(增删改查); get->查, post->增, put->改, delete->删。
- URL命名规则, 对于资源无法使用一个单数名词表示的情况, 我使用中横线(-)连接。

## mock一个真实案例（文章模块）
文章模块是简书项目一个核心模块之一，为读者提供阅读点赞收藏评价等功能，作者提供写作功能回复等功能。
那么集合上面说的一些相关功能，需要用到那些：
- 资源采用名词命名: 文章 -> article
- 资源列表: 文章列表 -> /article -> GET
- 新增资源: 新增文章 -> /article -> POST
- 修改资源: 修改文章 -> /article/:id -> PUT
- 资源详情: 指定文章详情 -> /article/:id -> GET
- 删除资源: 删除指定文章 -> /article/:id -> DELETE
- 资源关联关系：收藏文章 -> /article/:id/favorites -> PUT
- 资源关联关系：删除收藏文章 -> /article/:id/favorites -> DELETE
- 资源关联关系：文章点赞 -> /article/:id/star -> PUT
- 资源关联关系：取消文章点赞 -> /article/:id/star -> DELETE
- 资源关联关系: 文章评论列表 -> /article/:id/comments -> GET
- 资源关联关系: 文章评论回复 -> /article/:id/comments -> POST
- 资源关联关系: 删除文章评论回复 -> /comments/:id -> DELETE
- 资源关联关系: 文章评论点赞 -> /comments/:id/likes -> PUT
- 资源关联关系: 取消文章评论点赞 -> /comments/:id/likes -> DELETE

和文章相关大概就这些。

## 数据结构
### requestParams（请求参数）
所有请求参数都是以json形式提交，{}
范例格式：
```
{} 
```
### responseBody（返回结果）
范例格式：
```
{  
  "meta": {  
  },  
  "data": {  
  }  
}  
```
#### 获取列表 GET
范例格式1：下拉刷新自动加载
```
{  
  "meta": {
    "code": 200,  
    "message": "获取全部文章成功"    
  },  
  "data": []
}  
```
范例格式2：带分页
```
{  
  "meta": {
    "code": 200,  
    "message": "获取全部文章成功"    
  },  
  "data": [],
  "total": 100
}  
```
#### 获取单条数据 GET
范例格式：
```
{  
  "meta": {
    "code": 200,  
    "message": "查询成功"    
  },  
  "data": {}
}  
```
#### 添加一条数据 POST
范例格式：
```
{  
  "meta": {
    "code": 201,  
    "message": "创建成功"    
  },  
  "data": {}
}  
```
#### 编辑一条数据 PUT
范例格式：
```
{  
  "meta": {
    "code": 200,  
    "message": "修改成功"    
  },  
  "data": {}
}  
```
#### 删除一条数据 DELETE
范例格式：
```
{  
  "meta": {
    "code": 200,  
    "message": "删除成功"    
  },  
  "data": {}
}  
```
### 删除后查询无结果
范例格式：
```
{  
  "meta": {
    "code": 404,  
    "message": "访问文章不存在"    
  }
}  
```
### 其他异常处理
范例格式1：
```
{  
  "meta": {
    "code": 401,  
    "message": "未登陆"    
  }
}  
```
范例格式2：
```
{  
  "meta": {
    "code": 403,  
    "message": "无权限访问"    
  }
}  
```
### 字段解释
meta：响应结果

code：响应状态码，给前端处理。参见`状态码信息`

message：提示消息。成功和错误消息。一般就错误消息才进行显示和处理，成功消息直接略过。

错误信息一般有两种用途：一是客户端开发人员调试时看具体是什么错误；二是作为App错误提示直接展示给用户看。主要还是作为App错误提示，直接展示给用户看的。所以，大部分都是简短的提示信息。


data：返回数据

data字段只在请求成功时才会有数据返回的。数据类型限定为对象或数组，当请求需要的数据为单个对象时则传回对象，当请求需要的数据是列表时，则为某个对象的数组.

## 状态码信息
成功状态
- 200: GET请求成功，及DELETE或PATCH同步请求完成，或者PUT同步更新一个已存在的资源
- 201: POST 同步请求完成，或者PUT同步创建一个新的资源
- 202: POST，PUT，DELETE，或PATCH请求接收，将被异步处理
- 206: GET 请求成功，但是只返回一部分

错误状态
- 401 Unauthorized: 用户未认证，请求失败
- 403 Forbidden: 用户无权限访问该资源，请求失败
- 404 Notfound: 访问资源不存在，请求失败
- 422 Unprocessable Entity: 请求被服务器正确解析，但是包含无效字段
- 429 Too Many Requests: 因为访问频繁，你已经被限制访问，稍后重试
- 500 Internal Server Error: 服务器错误，确认状态并报告问题
